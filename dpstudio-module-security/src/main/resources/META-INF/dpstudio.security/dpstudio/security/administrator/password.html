<!DOCTYPE html>
<html lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
<title>修改密码</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-fullscreen" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="stylesheet" type="text/css" href="/statics/css/materialdesignicons.min.css">
<link rel="stylesheet" type="text/css" href="/statics/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/statics/css/animate.min.css">
<link rel="stylesheet" type="text/css" href="/statics/css/style.min.css">
<script type="text/javascript" src="/statics/js/jquery.min.js"></script>
<script type="text/javascript" src="/statics/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="/statics/js/main.min.js"></script>
<script type="text/javascript" src="/statics/js/angular.min.js"></script>
<script type="text/javascript" src="/statics/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/statics/js/perfect-scrollbar.min.js"></script>


</head>

<body ng-app="">
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
    <ng-include src="'/admin/common/sidebar.html'" onload="topSelect = 'home'"></ng-include>
    <!--End 左侧导航-->
    <!--头部信息-->
    <ng-include src="'/admin/common/header.html'"></ng-include>
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">
      <div class="container-fluid p-t-15">
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <form method="post" action="/dpstudio/security/admin/pwd/update" id="passwordForm">
                  <div class="form-group col-md-12">
                    <label for="old_pwd">旧密码</label>
                    <input type="text" class="form-control mx_required" id="old_pwd" name="old_pwd" mx_required_msg="旧密码不能为空" placeholder="旧密码"/>
                  </div>
                  <div class="form-group col-md-12">
                    <label for="new_pwd">新密码</label>
                    <input type="text" class="form-control mx_required" mx_required_msg="新密码不能为空" id="new_pwd" name="new_pwd"  placeholder="新密码" />
                  </div>
                  <div class="form-group col-md-12">
                    <label for="confirm_pwd">确认新密码</label>
                    <input type="text" class="form-control mx_required" mx_required_msg="" id="confirm_pwd" name="confirm_pwd"  placeholder="确认新密码" />
                  </div>
                  <button type="submit" class="btn btn-primary" id="submit">保存</button>
                </form>

              </div>
            </div>
          </div>

        </div>
      </div>
    </main>
    <!--End 页面主要内容-->
  </div>
</div>



<script type="text/javascript" src="/statics/js/custom/MX.js"></script>
<script type="text/javascript" src="/statics/js/custom/md5.js"></script>
<script type="text/javascript">
  $(function () {
    $('#passwordForm')
            .bootstrapValidator({
              message: '请输入正确内容',
              feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
              },
              fields: {
                old_pwd: {
                  validators: {
                    notEmpty: {
                      message: '原密码不能为空'
                    },
                  }
                },
                new_pwd: {
                  validators: {
                    notEmpty: {
                      message: '新密码不能为空'
                    },
                    identical: {
                      field: 'confirm_pwd',
                      message: '两次输入的密码不相符'
                    }
                  }
                },
                confirm_pwd: {
                  validators: {
                    notEmpty: {
                      message: '确认密码不能为空'
                    },
                    identical: {
                      field: 'new_pwd',
                      message: '两次输入的密码不相符'
                    }
                  }
                }
              }
            })
            .on('success.form.bv', function (e) {
              e.preventDefault();
              var $form = $(e.target);
              var data = FORM.getValues($('#passwordForm'));
              data.confirm_pwd = hex_md5(data.confirm_pwd);
              data.new_pwd = hex_md5(data.new_pwd);
              data.old_pwd = hex_md5(data.old_pwd);
              MX.axpost($form.attr("action"),data,true,null,function(e){
                if(e.ret === 0){
                  MX.successMsg("修改成功,请重新登录~")
                  setTimeout(function () {
                    window.location.href = "/dpstudio/security/login_view.html?logout=1";
                  }, 1000)
                }else{
                  MX.failMsg(e.msg != null ? e.msg : "修改失败")
                }
              })
            });
  });

</script>
</body>
</html>